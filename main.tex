\documentclass{utsignal}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{wrapfig}
\usepackage{verbatim}
\usepackage{fancyvrb}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{xepersian}
\usepackage{listings}
\usepackage{color}
\usepackage[utf8]{inputenc}
\usepackage{csquotes}

\title{پروژه - فاز ۲}
\course{سیگنال‌ها و سیستم‌ها}
\author{\href{mailto:h.barkhordarpour@ut.ac.ir?subject=[SS\%20S98 A2]}{هدی برخوردارپور}، 
\href{mailto:ranjbar.ali@ut.ac.ir?subject=[SS\%20S98 A2]\%20}{علی رنجبر}}
%\lecturer{امیرمسعود ربیعی}
\deadline{سه‌شنبه ۲۱ خرداد ۱۳۹۸، ساعت ۲۳:۵۵}
\graphicspath{{./images/}}


\begin{document}
	\maketitle
	\section*{مقدمه و یادآوری فاز ۱}
	با انجام فاز ۱ باید کدی نوشته باشید که با ورودی گرفتن یک کلیپ صوتی، ماتریس مربوط به جفت پیک‌های آن را برمی‌گرداند. این ماتریس در حالت کلی به شکل زیر است که در هر سطر آن اطلاعات زمانی و فرکانسی مربوط به هر جفت پیک ذخیره شده است.
	\begin{center}
		\begin{latin}
			\begin{tabular}{|c|c|c|c|}
				$t_1$ & $t_2$ & $f_1$ & $f_2$ \\
				\vdots&\vdots&\vdots&\vdots\\
				$t_j$ & $t_k$ & $f_j$ & $f_k$ \\
				\vdots&\vdots&\vdots&\vdots\\
				$t_m$ & $t_n$ & $f_m$ & $f_n$ \\
			\end{tabular}
		\end{latin}
	\end{center}
	حال می‌خواهیم تابعی بنویسم که جدول مربوط به آهنگ را ساخته و در پایگاه داده ذخیره کند. جدول مربوط به هر آهنگ به شکل زیر خواهد بود:
	\begin{center}
		\begin{latin}
			\begin{tabular}{|c|c|c|c|}
				$f_1$ & $f_2$ & $t_1^s$ & $t_2^s-t_1^s$\\
				&&&\vdots\\
				$f_j$ & $f_k$ & $t_j^s$ & $t_k^s-t_j^s$\\
				&&&\vdots\\
				$f_p$ & $f_q$ & $t_p^s$ & $t_q^s-t_p^s$\\
			\end{tabular}
		\end{latin}
	\end{center}
	اگر یک کلیپ صوتی از آهنگ‌های موجود در پایگاه داده داشته باشیم، هر سطر جدول کلیپ باید سطری متناظر در جدول آهنگ داشته باشد. برای مثال اگر $(f_1, f_2, t_1^c, t_2^c-t_1^c)$ یک سطر در جدول کلیپ و $(g_1, g_2, t_1^s, t_2^s-t_1^s)$ سطر متناظر آن در جدول آهنگ باشد، باید $f_1=g_1$، $f_2=g_2$ و $t_2^c-t_1^c=t_2^s-t_1^s$ باشند. چون این سه مقدار با شیفت زمانی کلیپ نسبت به ابتدای آهنگ، تغییر نمی‌کنند. در نتیجه استفاده از سه‌تایی $(f_1, f_2, t_2^c-t_1^c)$ راه خوبی برای جستوجوی تطبیق در پایگاه داده است.
	
	\section{ساخت پایگاه داده}
	در این قسمت دو پایگاه داده را برای ذخیره‌ی لیست آهنگ‌ها و اطلاعات زمانی جفت پیک‌ها آماده می‌کنیم. برای ذخیره‌ی لیست آهنگ‌ها کافیست از یک بردار تک ستون استفاده کنید که در هر ستون اسم فایل آهنگ نوشته شده است. شماره‌ی ردیف هر آهنگ شناسه‌ی\LTRfootnote{ID} آن آهنگ می‌باشد. این پایگاه داده را در فایل \lr{SONGID\_DB.mat} ذخیره کنید. پایگاه داده دوم  باید دو ستون داشته باشد. تعداد ردیف‌ها و نحوه‌ی پر کردن آن را در ادامه توضیح می‌دهیم. این پایگاه داده را در فایل \lr{HASHTABLE.mat} ذخیره کنید. 
	
	برای هر آهنگ دو فایل \lr{SONGID\_DB.mat} و \lr{HASHTABLE.mat} را بارگذاری کنید. ابتدا پایگاه داده‌ی \lr{SONGID\_DB} را به‌روز کنید. تابع \lstinline[language=Matlab]{peak_to_pair} چهارتایی $(t_1, t_2, f_1, f_2)$ را برای تمام جفت پیک‌های یک آهنگ تولید می‌کند. برای هر کدام از این چهار‌تایی‌ها ابتدا با استفاده از تابع چکیده‌ساز اندیس \lr{(index = $h(f_1^c, f_2^c, t_2^c-t_1^c)$)} مناسب آن را پیدا کرده سپس در ردیف آن اندیس پایگاه داده \lr{HASHTABLE} شناسه‌ی آهنگ و مقدار $t_1^s$ را ذخیره کنید.
	
	\section{تابع چکیده‌ساز}
	از آنجا که هر فرکانس را می‌توان با عددی بین ۰ تا ۲۵۵ بیان کرد، می‌توانیم هر فرکانس را با ۸ بیت نمایش دهیم. با توجه‌ به عرض زمانی پنجره‌ی هدف می‌توان بازه‌ای برای $(t_2-t_1)$ پیدا کرد. از این رو تابع چکیده‌ساز را به‌صورت زیر می‌نویسیم:
	$$h(f_1, f_2, t_2-t_1) = (t_2-t_1).2^{16} + f_1.2^8 + f_2$$
	با توجه به این تابع تعیین کنید که طول پایگاه داده‌ی \lr{HASHTABLE} باید چقدر باشد. حال می‌توانید با استفاده از این تابع در هر ردیف اطلاعات لازم را ذخیره کنید. در صورت پر بودن یک ردیف از قبل می‌توانید از روش زنجیره‌سازی (یا روش‌های دیگری مثل کاوش خطی و ...) استفاده کنید.
	
	دقت کنید که کد شما باید قابلیت ایجاد پایگاه‌ داده را برای آهنگ‌های موجود در یک پوشه به صورت خودکار داشته باشد.
	
	\section{یافتن تطبیق برای کلیپ‌ها}
	برای یک کلیپ، ابتدا با استفاده از تابع \lstinline[language=Matlab]{voiceprint} محل پیک‌ها و با استفاده از تابع \lstinline[language=Matlab]{peak_to_pair} جفت پیک‌ها را بدست آورید. حال برای هر کدام از چهارتایی‌های $(t_1, t_2, f_1, f_2)$ محل مناسب (اندیس) آن در \lr{HASHTABLE} را بدست آورید. اگر جدول هش در آن اندیس خالی باشد، این چهارتایی کمکی در یافتن تطبیق نمی‌کند. در صورتی که خالی نباشد باید تعداد تطبیق‌های موجود در آن اندیس را با توجه به شناسه‌ی هر آهنگ بشمارید. این کار را برای همه‌ی چهارتایی‌های بدست آمده برای کلیپ انجام دهید. شناسه‌ی آهنگی که بیشترین مورد تطبیقی برای آن یافت شود، بهترین تطبیق برای آن کلیپ است.
	
	کد‌های خود در این قسمت را در تابعی به اسم \lstinline[language=Matlab]{match_clip} ارائه دهید. این تابع باید مسیر کامل یک کلیپ را ورودی بگیرد و اسم آهنگ تطبیق یافته را از پایگاه داده‌ی \lr{SONGID\_DB} برگرداند.
	
	این کار را به صورت خودکار برای کلیپ‌های موجود در یک پوشه انجام دهید و تعداد تطبیق‌های درست را گزارش کنید. برای یافتن تمام فایل‌هایی با پسوند \lr{mp3} داخل یک پوشه می‌توانید از تابع \lr{\lstinline[language=Matlab]{get_mp3_list}} (که در اختیارتان قرار گرفته) استفاده کنید.
	
	\section{اضافه کردن نویز (امتیازی)}
	در این قسمت عملیات یافتن تطبیق برای یک کلیپ را با اضافه کردن نویر به آن انجام دهید. برای این کار کلیپ را از یک کانال نویزی عبور دهید که می‌توانید از دستور \lr{\lstinline[language=Matlab]{awgn(clip, snr)}} استفاده کنید. این کار را برای \lr{\lstinline[language=Matlab]{snr = -15 : 3 : 15;}} انجام دهید. در چه \lr{SNR}ای (نسبت توان سیگنال به نویز) دیگر نمی‌توان کلیپی را درست تطبیق داد؟ تعداد تطبیق‌های درست در هر \lr{SNR} گزارش کنید.
	
	\section*{نکات تحویل}
	فایل‌های خود را با نام \lr{P2-SID.zip} در صفحه‌ی \lr{CECM} درس بارگذاری کنید که \lr{SID} شماره‌ی دانشجویی شماست؛ برای مثال اگر شماره‌ی دانشجویی شما ۸۱۰۱۹۶۹۹۹ باشد، نام پرونده‌ی شما باید \lr{P2-810196999.zip} باشد.
	\begin{itemize}
		\item این تمرین را می‌توانید با پایتون یا متلب انجام دهید.
		\item از تابع \lstinline[language=Matlab]{peak_to_pair} جدید استفاده کنید.
		\item تعدادی آهنگ با قطعه‌هایی از آن‌ها به شما داده شده است. سعی کنید آهنگ‌ها و قطعه‌هایی از آن‌ها (حتی با کیفیت‌های متفاوت) به این مجموعه اضافه کرده و کد خود را تست کنید. (در این زمینه برنامه‌ی \lr{Audacity} می‌تواند مفید باشد.)
		\item اگر اسم توابعی که باید بنویسید، مشخص شده است، حتما آن را رعایت کنید.
		\item هدف این تمرین یادگیری شماست. لطفاً تمرین را خودتان انجام دهید. در صورت کشف تقلب مطابق قوانین درس با آن برخورد خواهد شد.
		\item سوالات خود را از طریق ایمیل بپرسید:
		\subitem \href{mailto:h.barkhordarpour@ut.ac.ir?subject=[SS\%20S98 P1]}{h.barkhordarpour@ut.ac.ir}
		\subitem \href{mailto:ranjbar.ali@ut.ac.ir?subject=[SS\%20S98 P1]}{ranjbar.ali@ut.ac.ir}
	\end{itemize}
\end{document}
